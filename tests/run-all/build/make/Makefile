# Makefile generated by Nomaj
# Project: ansible-playbook-deploy-kubespray
# Config: {'ansible': {'extra_vars': {'helm_enabled': True, 'local_volume_provisioner_enabled': True, 'local_volume_provisioner_storage_classes': {'local-storage': {'host_dir': '/mnt/disks', 'mount_dir': '/mnt/disks'}}}, 'inventory': {'all': {'children': {'calico-rr': {'hosts': {}}, 'etcd': {'hosts': {'k-1': None, 'k-2': None, 'k-3': None}}, 'k8s-cluster': {'children': {'kube-k': None, 'kube-master': None}}, 'kube-k': {'hosts': {'k-1': None, 'k-2': None, 'k-3': None}}, 'kube-master': {'hosts': {'k-1': None, 'k-2': None}}}, 'hosts': {'k-1': None, 'k-2': None, 'k-3': None}, 'vars': {'ansible_python_interpreter': '/usr/bin/python3'}}}, 'playbooks': [{'name': 'ansible-playbook-deploy-kubespray', 'scm': 'git', 'src': 'https://github.com/pwyoung/ansible-playbook-deploy-kubespray.git', 'version': 'master'}], 'roles': [{'name': 'ansible-role-mount-disks', 'scm': 'git', 'src': 'https://github.com/pwyoung/ansible-role-mount-disks.git', 'version': 'master'}, {'name': 'create_partition', 'scm': 'git', 'src': 'https://github.com/mcgrof/create_partition.git', 'version': 'v1.2.1'}]}, 'docker': {'compose': {'services': {'hello_world': {'command': ['/bin/echo', 'Hello world'], 'image': 'ubuntu'}}, 'version': '2'}, 'enabled': False}, 'generic': {'project_namespace': 'ansible-playbook-deploy-kubespray'}, 'vagrant': {'boxes': [{'name': 'k-1'}, {'name': 'k-2'}, {'name': 'k-3'}], 'global': {'boot_timeout': 300, 'cpus': 4, 'libvirt_cfg': {'append_project_name_to_nvme_disk_path': 'true', 'box': 'generic/ubuntu1804', 'emulator_path': '/usr/bin/qemu-system-x86_64', 'enabled': True, 'machine_type': 'q35', 'nvme_disk_id_prefix': 'drv', 'nvme_disk_path': '$HOME/.local/share/libvirt/images/', 'nvme_disk_postfix': 'qcow2', 'qemu_group': None}, 'memory': 4096, 'nvme_disks': {'data1': {'size': 102400}, 'data10': {'size': 102400}, 'data11': {'size': 102400}, 'data12': {'size': 102400}, 'data13': {'size': 102400}, 'data14': {'size': 102400}, 'data15': {'size': 102400}, 'data16': {'size': 102400}, 'data17': {'size': 102400}, 'data18': {'size': 102400}, 'data19': {'size': 102400}, 'data2': {'size': 102400}, 'data20': {'size': 102400}, 'data3': {'size': 102400}, 'data4': {'size': 102400}, 'data5': {'size': 102400}, 'data6': {'size': 102400}, 'data7': {'size': 102400}, 'data8': {'size': 102400}, 'data9': {'size': 102400}}, 'virtualbox_cfg': {'append_project_name_to_nvme_disk_path': 'true', 'box': 'generic/ubuntu1804', 'enable_sse4': True, 'enabled': True, 'nvme_disk_path': '.vagrant/nvme_disks/', 'nvme_disk_postfix': 'vdi', 'nvme_disk_prefix': 'nvme_disk'}}}}
# Vagrant: True

# Vagrant: True
# Ansible: True

MAKEFILE_PATH=$(dir $(realpath $(firstword $(MAKEFILE_LIST))))
EXISTING_BUILD_DIR=$(MAKEFILE_PATH)/..
MERGED_CONFIG_FILE=$(MAKEFILE_PATH)/../config.yaml

# Run nomaj but re-use the build_dir and config file that were created
# when "nomaj -m make" was run.
NOMAJ?=/home/pyoung/git/current/nomaj/nomaj
NOMAJ+=--config-file $(MERGED_CONFIG_FILE)
NOMAJ+=--build-dir $(EXISTING_BUILD_DIR)

.PHONY=all

all:
	$(info MAKE ALL)
	$(NOMAJ) -m vagrant -x run
	$(NOMAJ) -m ansible -x run

clean:
	$(info MAKE CLEAN)
	$(NOMAJ) -m vagrant -x clean
